## Второй блок. Упражнения 5 и 6

### Упражнение 5. Многопользовательский «Доктор»

Текущая версия программы умеет работать только с одним пациентом, имя которого задаётся в вызове функции ***visit-doctor***. Когда пациент говорит ***goodbye***, ***visit-doctor*** возвращает управление интерпретатору. Измените программу таким образом, чтобы «Доктор» автоматически переходил к приёму следующего пациента после прощания с предыдущим. Предусмотрите способ завершения работы многопользовательского «Доктора» или после использования стоп-слова в качестве имени очередного пациента, или при исчерпании количества принимаемых пациентов. Стоп-слово и максимальное количество пациентов передаются в обновлённый ***visit-doctor-v2*** как значения его параметров. Например, `(visit-doctor-v2 'suppertime 3)` может завершиться либо если трое пациентов обслужено, либо если введено имя пациента suppertime. Для ввода имени очередного пациента можете воспользоваться функцией ***ask-patient-name*** (заметьте, что именем пациента считается первый элемент списка, введённого пользователем):
```
(define (ask-patient-name)
 (begin
  (println '(next!))
  (println '(who are you?))
  (print '**)
  (car (read))
 ) 
)
```

Теперь сессия работы «Доктора» может выглядеть следующим образом:
```
> (visit-doctor-v2 'suppertime 3)
(next!)
(who are you?) 
**(hal abelson)
(hello, hal)
(what seems to be the trouble?)
**(everyone taking 6.001 hates me)
(why do you say everyone taking 6.001 hates you)
...
**(goodbye)
(goodbye, hal)
(see you next week)
(next!)
(who are you?)
**(eric grimson)
(hello, eric)
(what seems to be the trouble?)
...
**(goodbye)
(goodbye, eric)
(see you next week)
(next!)
(who are you?)
**(suppertime)
(time to go home)
```

### Упражнение 6. 4-я стратегия генерации ответов

Реализуйте ещё одну стратегию генерации ответных реплик, зависящую от ключевых слов в реплике пациента. Например, на фразу *"i am often depressed"* «Доктор» может ответить *"when you feel depressed, go out for ice cream"*. Структура данных, хранящая группы ключевых слов и привязанных к ним шаблонов для составления ответных реплик должна выглядеть так:
```
(define keywords-structure '#(
  #( ; начало данных 1й группы
    #(depressed suicide exams university) ; вектор ключевых слов 1й группы
    #( ; вектор шаблонов для составления ответных реплик 1й группы 
	  (when you feel depressed, go out for ice cream) ; 1й шаблон 1й группы -- список символов
      (depression is a disease that can be treated)
	)
  ) ; завершение данных 1й группы
  #( ; начало данных 2й группы ...
    #(mother father parents brother sister uncle aunt grandma grandpa)
    #(
	  (tell me more about your * , i want to know all about your *)
      (why do you feel that way about your * ?)
	)
  )
  #(
    #(university scheme lections)
	#(
	  (your education is important)
	  (how much time do you spend on your studies ?)
	)
  )
))
```

Можно видеть, что в разные группы ключевых слов могут входить одни и те же слова. Если в шаблоне ответной реплики есть звёздочка, это значит, что в ответе вместо * «Доктор» укажет ключевое слово, по которому он построил реплику. Например, на фразу пользователя, содержащую слово ***father*** может быть дан ответ *"tell me more about your father , i want to know all about your father"*.

#### Задание упражнения 6. 
Реализуйте в программе стратегию построения ответов по ключевым словам. Пополните набор групп ключевых слов (не менее чем двумя новыми группами). Пополните шаблоны ответов, в том числе для 1й и для 2й групп (не менее чем двумя шаблонами для каждой группы). Построение реплик по ключевым словам должно быть реализовано так, чтобы можно было вносить изменения только в ***keywords-structure***, не исправляя код функции, составляющей реплику. Реализуйте случайный выбор ключевого слова для построения реплики, если этих слов несколько во фразе пользователя. Реализуйте для этой цели аналог ***pick-random-vector*** для списков. Этот выбор должен учитывать количество вхождений слова в реплику пациента. Например, в реплике *"(i feel depressed about scheme ! scheme is ugly language !)"* три вхождения ключевых слов: одно -- ***depressed*** и два -- ***scheme***. Значит, вероятность выбрать ***depressed = 1/3***, а ***scheme = 2/3***. Когда выбор ключевого слова сделан, по нему следует выбрать один из подходящих шаблонов для составления ответной реплики. Предусмотрите учёт ситуации, когда одно и то же ключевое слово относится к разным группам. Для таких слов следует выбирать шаблон из объединённого перечня всех шаблонов, относящихся к каждой группе, куда входит ключевое слово. В выбранном шаблоне следует заменить * на ключевое слово. При этом следует использовать ту реализацию замен, которая уже есть в коде «Доктора». Поскольку построение реплики является обработкой списков и векторов, то напишите код с использованием уместных функций высшего порядка (***map***, ***foldl***, ***foldr***, ***filter***, ***andmap***, ***ormap*** ..., точнее, их аналогов для векторов (см. документацию среды DrRacket)). Если потребуется, то используйте ***call/cc*** для досрочного возвращения результата. Не используйте перевод векторов в списки и/или списков в вектора.

Стратегия построения реплики по ключевым словам применима только в том случае, когда в реплике есть хотя бы одно какое-то ключевое слово. Следует описать отдельную функцию-чеккер, проверяющую это. Функция-чеккер должна быть эффективной. Она не должна делать лишних действий, после того как становится ясно, что стратегия применима. Если для работы функции-чеккера не нужна вся структура данных ***keywords-structure***, хранящая группы ключевых слов и привязанных к ним шаблонов, то следует однократно предобработать ***keywords-structure***, получив необходимые данные, и затем использовать результат однократной предобработки в вызовах функции-чеккера. Для выбора стратегий занумеруйте стратегии так, чтобы условно-применимые стратегии получили граничные номера -- *0* и *N-1*, затем задействуйте `(random M N)`, подставляя в вызов верно рассчитанные границы диапазона *M..N*.